# Userspace VM

## TODO 

Implementing a userspace eBPF implementation is not trivial and we don't be doing all of it at once. The following features still need to be implemented

**Instructions**:

- Atomic sub
- Atomic and
- Atomic Or
- Atomic Xor
- Atomic Exchange
- Atomic Compare and exchange

**Mechanisms**:

- ~~bpf-to-bpf~~
- ~~Tailcalling~~

**Map types**:

- ~~BPF_MAP_TYPE_ARRAY~~
- ~~BPF_MAP_TYPE_HASH~~
- ~~BPF_MAP_TYPE_PROG_ARRAY~~
- ~~BPF_MAP_TYPE_PERF_EVENT_ARRAY~~
- ~~BPF_MAP_TYPE_PERCPU_HASH~~ (currently we just use the normal map since we don't support parallel execution)
- ~~BPF_MAP_TYPE_PERCPU_ARRAY~~ (currently we just use the normal map since we don't support parallel execution)
- BPF_MAP_TYPE_STACK_TRACE
- BPF_MAP_TYPE_CGROUP_ARRAY
- ~~BPF_MAP_TYPE_LRU_HASH~~
- ~~BPF_MAP_TYPE_LRU_PERCPU_HASH~~ (currently we just use the normal map since we don't support parallel execution)
- BPF_MAP_TYPE_LPM_TRIE
- ~~BPF_MAP_TYPE_ARRAY_OF_MAPS~~
- ~~BPF_MAP_TYPE_HASH_OF_MAPS~~
- BPF_MAP_TYPE_DEVMAP
- BPF_MAP_TYPE_SOCKMAP
- BPF_MAP_TYPE_CPUMAP
- BPF_MAP_TYPE_XSKMAP
- BPF_MAP_TYPE_SOCKHASH
- BPF_MAP_TYPE_CGROUP_STORAGE
- BPF_MAP_TYPE_REUSEPORT_SOCKARRAY
- BPF_MAP_TYPE_PERCPU_CGROUP_STORAGE
- ~~BPF_MAP_TYPE_QUEUE~~
- ~~BPF_MAP_TYPE_STACK~~
- BPF_MAP_TYPE_SK_STORAGE
- BPF_MAP_TYPE_DEVMAP_HASH
- BPF_MAP_TYPE_STRUCT_OPS
- BPF_MAP_TYPE_RINGBUF
- BPF_MAP_TYPE_INODE_STORAGE
- BPF_MAP_TYPE_TASK_STORAGE

**Linux helpers**:

- ~~bpf_lookup_element~~
- ~~bpf_update_element~~
- bpf_delete_element
- bpf_probe_read
- bpf_ktime_get_ns
- bpf_trace_printk
- bpf_get_prandom_u32
- bpf_get_smp_processor_id
- bpf_skb_store_bytes
- bpf_l3_csum_replace
- bpf_l4_csum_replace
- ~~bpf_tail_call~~
- bpf_clone_redirect
- ~~bpf_get_current_pid_tgid~~
- bpf_get_current_uid_gid
- bpf_get_current_comm
- bpf_get_cgroup_classid
- bpf_skb_vlan_push
- bpf_skb_vlan_pop
- bpf_skb_get_tunnel_key
- bpf_skb_set_tunnel_key
- bpf_perf_event_read
- bpf_redirect
- bpf_get_route_realm
- ~~bpf_perf_event_output~~
- bpf_skb_load_bytes
- bpf_get_stackid
- bpf_csum_diff
- bpf_skb_get_tunnel_opt
- bpf_skb_set_tunnel_opt
- bpf_skb_change_proto
- bpf_skb_change_type
- bpf_skb_under_cgroup
- bpf_get_hash_recalc
- bpf_get_current_task
- bpf_probe_write_user
- bpf_current_task_under_cgroup
- bpf_skb_change_tail
- bpf_skb_pull_data
- bpf_csum_update
- bpf_set_hash_invalid
- bpf_get_numa_node_id
- bpf_skb_change_head
- bpf_xdp_adjust_head
- bpf_probe_read_str
- bpf_get_socket_cookie
- bpf_get_socket_uid
- bpf_set_hash
- bpf_setsockopt
- bpf_skb_adjust_room
- bpf_redirect_map
- bpf_sk_redirect_map
- bpf_sock_map_update
- bpf_xdp_adjust_meta
- bpf_perf_event_read_value
- bpf_perf_prog_read_value
- bpf_getsockopt
- bpf_override_return
- bpf_sock_ops_cb_flags_set
- bpf_msg_redirect_map
- bpf_msg_apply_bytes
- bpf_msg_cork_bytes
- bpf_msg_pull_data
- bpf_bind
- bpf_xdp_adjust_tail
- bpf_skb_get_xfrm_state
- bpf_get_stack
- bpf_skb_load_bytes_relative
- bpf_fib_lookup
- bpf_sock_hash_update
- bpf_msg_redirect_hash
- bpf_sk_redirect_hash
- bpf_lwt_push_encap
- bpf_lwt_seg6_store_bytes
- bpf_lwt_seg6_adjust_srh
- bpf_lwt_seg6_action
- bpf_rc_repeat
- bpf_rc_keydown
- bpf_skb_cgroup_id
- bpf_get_current_cgroup_id
- bpf_get_local_storage
- bpf_sk_select_reuseport
- bpf_skb_ancestor_cgroup_id
- bpf_sk_lookup_tcp
- bpf_sk_lookup_udp
- bpf_sk_release
- ~~bpf_map_push_elem~~
- ~~bpf_map_pop_elem~~
- ~~bpf_map_peek_elem~~
- bpf_msg_push_data
- bpf_msg_pop_data
- bpf_rc_pointer_rel
- bpf_spin_lock
- bpf_spin_unlock
- bpf_sk_fullsock
- bpf_tcp_sock
- bpf_skb_ecn_set_ce
- bpf_get_listener_sock
- bpf_skc_lookup_tcp
- bpf_tcp_check_syncookie
- bpf_sysctl_get_name
- bpf_sysctl_get_current_value
- bpf_sysctl_get_new_value
- bpf_sysctl_set_new_value
- bpf_strtol
- bpf_strtoul
- bpf_sk_storage_get
- bpf_sk_storage_delete
- bpf_send_signal
- bpf_tcp_gen_syncookie
- bpf_skb_output
- bpf_probe_read_user
- bpf_probe_read_kernel
- bpf_probe_read_user_str
- bpf_probe_read_kernel_str
- bpf_tcp_send_ack
- bpf_send_signal_thread
- bpf_jiffies64
- bpf_read_branch_records
- bpf_get_ns_current_pid_tgid
- bpf_xdp_output
- bpf_get_netns_cookie
- bpf_get_current_ancestor_cgroup_id
- bpf_sk_assign
- bpf_ktime_get_boot_ns
- bpf_seq_printf
- bpf_seq_write
- bpf_sk_cgroup_id
- bpf_sk_ancestor_cgroup_id
- bpf_ringbuf_output
- bpf_ringbuf_reserve
- bpf_ringbuf_submit
- bpf_ringbuf_discard
- bpf_ringbuf_query
- bpf_csum_level
- bpf_skc_to_tcp6_sock
- bpf_skc_to_tcp_sock
- bpf_skc_to_tcp_timewait_sock
- bpf_skc_to_tcp_request_sock
- bpf_skc_to_udp6_sock
- bpf_get_task_stack
- bpf_load_hdr_opt
- bpf_store_hdr_opt
- bpf_reserve_hdr_opt
- bpf_inode_storage_get
- bpf_inode_storage_delete
- bpf_d_path
- bpf_copy_from_user
- bpf_snprintf_btf
- bpf_seq_printf_btf
- bpf_skb_cgroup_classid
- bpf_redirect_neigh
- bpf_per_cpu_ptr
- bpf_this_cpu_ptr
- bpf_redirect_peer
- bpf_task_storage_get
- bpf_task_storage_delete
- bpf_get_current_task_btf
- bpf_bprm_opts_set
- bpf_ktime_get_coarse_ns
- bpf_ima_inode_hash
- bpf_sock_from_file
- bpf_check_mtu
- bpf_for_each_map_elem
- bpf_snprintf
- bpf_sys_bpf
- bpf_btf_find_by_name_kind
- bpf_sys_close
- bpf_timer_init
- bpf_timer_set_callback
- bpf_timer_start
- bpf_timer_cancel
- bpf_get_func_ip
- bpf_get_attach_cookie
- bpf_task_pt_regs
- bpf_get_branch_snapshot
- bpf_trace_vprintk
- bpf_skc_to_unix_sock
- bpf_kallsyms_lookup_name
- bpf_find_vma
- bpf_loop
- bpf_strncmp
- bpf_get_func_arg
- bpf_get_func_ret
- bpf_get_func_arg_cnt